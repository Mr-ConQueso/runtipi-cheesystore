{
  "schemaVersion": 2,
  "services": [
    {
      "name": "aptabase_db",
      "image": "postgres:15-alpine",
      "environment": [
        {
          "key": "POSTGRES_USER",
          "value": "aptabase"
        },
        {
          "key": "POSTGRES_PASSWORD",
          "value": "sTr0NGp4ssw0rd"
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/db-data",
          "containerPath": "/var/lib/postgresql/data",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ]
    },
    {
      "name": "aptabase_events_db",
      "image": "clickhouse/clickhouse-server:23.8.4.69-alpine",
      "environment": [
        {
          "key": "CLICKHOUSE_USER",
          "value": "aptabase"
        },
        {
          "key": "CLICKHOUSE_PASSWORD",
          "value": "sTr0NGp4ssw0rd"
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/events-db-data",
          "containerPath": "/var/lib/clickhouse",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ],
      "ulimits": {
        "nofile": {
          "soft": 262144,
          "hard": 262144
        }
      }
    },
    {
      "name": "aptabase_app",
      "image": "ghcr.io/aptabase/aptabase:main",
      "environment": [
        {
          "key": "BASE_URL",
          "value": "http://localhost:8000"
        },
        {
          "key": "AUTH_SECRET",
          "value": "c4rI4x8kz5DgKJ1is5Eiu9bNncSQ6ROD"
        },
        {
          "key": "DATABASE_URL",
          "value": "Server=aptabase_db;Port=5432;User Id=aptabase;Password=sTr0NGp4ssw0rd;Database=aptabase"
        },
        {
          "key": "CLICKHOUSE_URL",
          "value": "Host=aptabase_events_db;Port=8123;Username=aptabase;Password=sTr0NGp4ssw0rd"
        }
      ],
      "internalPort": 8000,
      "addPorts": [
        {
          "containerPort": 8080,
          "hostPort": 8000,
          "tcp": true,
          "udp": false
        }
      ],
      "dependsOn": [
        "aptabase_events_db",
        "aptabase_db"
      ]
    }
  ]
}